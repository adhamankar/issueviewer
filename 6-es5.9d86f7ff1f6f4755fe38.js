function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var i=[],s=!0,n=!1,c=void 0;try{for(var r,l=e[Symbol.iterator]();!(s=(r=l.next()).done)&&(i.push(r.value),!t||i.length!==t);s=!0);}catch(o){n=!0,c=o}finally{try{s||null==l.return||l.return()}finally{if(n)throw c}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{cyGc:function(e,t,i){"use strict";i.r(t);var s=i("ofXK"),n=i("kt0X"),c={selectedItem:null,item:null,recentlyViewedItems:[],recentmostItem:null},r=i("j9Al"),l={SetSelectedItem:Object(r.a)("[SetSelectedItem]"),SetPurpose:Object(r.a)("[SetPurpose]"),SetRecentlyViewed:Object(r.a)("[SetRecentlyViewed]")},o=function e(t){_classCallCheck(this,e),this.payload=t,this.type=l.SetSelectedItem},a=function e(t){_classCallCheck(this,e),this.payload=t,this.type=l.SetPurpose};function u(e,t){switch(t.type){case l.SetSelectedItem:return Object.assign(Object.assign({},e),{selectedItem:t.payload});case l.SetPurpose:return Object.assign(Object.assign({},e),{item:t.payload});case l.SetRecentlyViewed:return Object.assign(Object.assign({},e),{recentmostItem:t.payload});default:return e}}var d=i("fXoL"),b=i("pLZG"),p=i("ze3F"),f=i("6NWb"),h=i("l2bN"),m=i("1kSV");function g(e,t){1&e&&(d.Wb(0,"div"),d.Rb(1,"fa-icon",2),d.Kc(2," There are no extended fields/attributes for this record. "),d.Vb())}var v=function(e){return{small:e}};function y(e,t){if(1&e&&(d.Wb(0,"div",5),d.Wb(1,"div",6),d.Wb(2,"div",7),d.Kc(3),d.Vb(),d.Wb(4,"div",8),d.Wb(5,"ngx-md"),d.Kc(6),d.Vb(),d.Vb(),d.Vb(),d.Vb()),2&e){var i=t.$implicit,s=d.kc(3);d.Cb(3),d.Lc(i.name),d.Cb(1),d.pc("ngClass",d.tc(3,v,s.fontSizeSmall)),d.Cb(2),d.Mc(" ",i.value," ")}}function I(e,t){if(1&e&&(d.Wb(0,"div",3),d.Ic(1,y,7,5,"div",4),d.Vb()),2&e){var i=d.kc(2);d.Cb(1),d.pc("ngForOf",i.issue.extendedFields)}}function k(e,t){if(1&e&&(d.Wb(0,"div"),d.Ic(1,g,3,0,"div",0),d.Ic(2,I,2,1,"div",1),d.Vb()),2&e){var i=d.kc();d.Cb(1),d.pc("ngIf",!i.issue.extendedFields||0===i.issue.extendedFields.length),d.Cb(1),d.pc("ngIf",i.issue.extendedFields&&i.issue.extendedFields.length>0)}}var C,V=((C=function e(){_classCallCheck(this,e),this.fontSizeSmall=!1}).\u0275fac=function(e){return new(e||C)},C.\u0275cmp=d.Kb({type:C,selectors:[["app-extended-fields"]],inputs:{issue:"issue"},decls:1,vars:1,consts:[[4,"ngIf"],["class","list-group list-group-flush small",4,"ngIf"],["icon","exclamation-triangle",1,"text-info"],[1,"list-group","list-group-flush","small"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"row"],[1,"col-md-2","small","text-muted","text-uppercase"],[1,"col-md-10",3,"ngClass"]],template:function(e,t){1&e&&d.Ic(0,k,3,2,"div",0),2&e&&d.pc("ngIf",t.issue)},directives:[s.l,f.a,s.k,s.j,h.a],encapsulation:2}),C);function W(e,t){if(1&e&&(d.Wb(0,"div",17),d.Wb(1,"h5",18),d.Kc(2),d.Vb(),d.Wb(3,"ngx-md"),d.Kc(4),d.Vb(),d.Vb()),2&e){var i=d.kc().$implicit;d.Cb(2),d.Mc(" ",i.title," "),d.Cb(2),d.Mc(" ",i.purpose," ")}}var w=function(e){return{"float-left":e}};function F(e,t){if(1&e&&(d.Wb(0,"div",9),d.Rb(1,"div",3),d.Wb(2,"div",14),d.Wb(3,"a",11),d.ic("click",(function(){var e=t.$implicit;return e.show=!e.show})),d.Rb(4,"fa-icon",12),d.Wb(5,"span",15),d.Kc(6),d.Vb(),d.Vb(),d.Vb(),d.Ic(7,W,5,2,"div",16),d.Vb()),2&e){var i=t.$implicit;d.pc("ngClass",d.tc(4,w,!i.show)),d.Cb(4),d.pc("icon",i.show?"chevron-down":"chevron-right"),d.Cb(2),d.Mc("",i.issueType," purpose"),d.Cb(1),d.pc("ngIf",i.show)}}var x=function(e){return{small:e}};function j(e,t){if(1&e){var i=d.Xb();d.Wb(0,"div",9),d.Wb(1,"div",10),d.Wb(2,"a",11),d.ic("click",(function(){d.Bc(i);var e=d.kc();return e.showHideAllPurposes(!e.showAll)})),d.Rb(3,"fa-icon",12),d.Vb(),d.Vb(),d.Ic(4,F,8,6,"div",13),d.Vb()}if(2&e){var s=d.kc();d.pc("ngClass",d.tc(3,x,s.fontSizeSmall)),d.Cb(3),d.pc("icon",s.showAll?"angle-double-down":"angle-double-right"),d.Cb(1),d.pc("ngForOf",s.purpose)}}function S(e,t){if(1&e){var i=d.Xb();d.Wb(0,"div",19),d.Wb(1,"button",20),d.ic("click",(function(){d.Bc(i);var e=d.kc();return e.hideExtendedFields=!e.hideExtendedFields})),d.Rb(2,"fa-icon",21),d.Wb(3,"span",15),d.Kc(4,"DETAILS"),d.Vb(),d.Vb(),d.Wb(5,"div",22),d.Rb(6,"app-extended-fields",23),d.Vb(),d.Vb()}if(2&e){var s=d.kc();d.Cb(2),d.pc("icon",s.hideExtendedFields?"chevron-right":"chevron-down"),d.Cb(3),d.pc("ngbCollapse",s.hideExtendedFields),d.Cb(1),d.pc("issue",s.selectedItem)}}var O,T=((O=function(){function e(t,i){_classCallCheck(this,e),this.persistenceService=t,this.store$=i,this.edit=new d.n,this.showAll=!1,this.hideExtendedFields=!1,this.fontSizeSmall=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.selectedItem$=this.store$.select((function(e){return e.purpose.selectedItem})).pipe(Object(b.a)((function(e){return e}))).subscribe((function(t){return e.selectedItem=t})),this.purpose$=this.store$.select((function(e){return e.purpose.item})).pipe(Object(b.a)((function(e){return e}))).subscribe((function(t){e.purpose=t,e.showHideAllPurposes(!1)}))}},{key:"ngOnDestroy",value:function(){this.purpose$&&this.purpose$.unsubscribe(),this.hierarchySetupVisibility$&&this.hierarchySetupVisibility$.unsubscribe(),this.selectedItem$&&this.selectedItem$.unsubscribe()}},{key:"showHideAllPurposes",value:function(e){var t=this;this.showAll=e,this.purpose&&(this.purpose.forEach((function(e){return e.show=t.showAll})),!this.showAll&&this.purpose.length>0&&(this.purpose[this.purpose.length-1].show=!0))}}]),e}()).\u0275fac=function(e){return new(e||O)(d.Qb(p.a),d.Qb(n.h))},O.\u0275cmp=d.Kb({type:O,selectors:[["app-purpose"]],outputs:{edit:"edit"},decls:12,vars:4,consts:[[1,"row"],[1,"col-md-10"],[3,"ngClass",4,"ngIf"],[1,"clearfix"],["class","ml-4 mr-5",4,"ngIf"],[1,"col-md-2"],[1,"sticky-title","text-right"],[1,"btn","btn-light","btn-sm","mr-2",3,"disabled","click"],[1,"btn","btn-light",3,"disabled","click"],[3,"ngClass"],[1,"border-0","pb-0","mb-2","float-left"],["title","Show/hide details",1,"btn","btn-light","btn-sm","text-muted","mr-2",3,"click"],["size","fw",3,"icon"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"text-uppercase","text-muted"],[1,"small"],["class","ml-3 pl-3 pr-3 border-left","style","overflow:auto",4,"ngIf"],[1,"ml-3","pl-3","pr-3","border-left",2,"overflow","auto"],[1,"text-dark","font-weight-normal","mt-1"],[1,"ml-4","mr-5"],[1,"btn","btn-sm","btn-light","text-muted",3,"click"],["size","sm",3,"icon"],[1,"ml-3","border-left",3,"ngbCollapse"],[3,"issue"]],template:function(e,t){1&e&&(d.Wb(0,"div",0),d.Wb(1,"div",1),d.Ic(2,j,5,5,"div",2),d.Wb(3,"div",3),d.Kc(4,"\xa0"),d.Vb(),d.Ic(5,S,7,3,"div",4),d.Vb(),d.Wb(6,"div",5),d.Wb(7,"div",6),d.Wb(8,"button",7),d.ic("click",(function(){return t.fontSizeSmall=!0})),d.Kc(9,"A"),d.Vb(),d.Wb(10,"button",8),d.ic("click",(function(){return t.fontSizeSmall=!1})),d.Kc(11,"A"),d.Vb(),d.Vb(),d.Vb(),d.Vb()),2&e&&(d.Cb(2),d.pc("ngIf",t.purpose&&t.purpose.length>0),d.Cb(3),d.pc("ngIf",t.selectedItem&&t.selectedItem.extendedFields&&t.selectedItem.extendedFields.length>0),d.Cb(3),d.pc("disabled",t.fontSizeSmall),d.Cb(2),d.pc("disabled",!t.fontSizeSmall))},directives:[s.l,s.j,f.a,s.k,h.a,m.b,V],encapsulation:2}),O),$=i("tyNb"),K=i("e/fS"),L=i("3Pt+"),A=i("jLSX"),E=i("krUz"),M=i("LvDl"),R=i("itXk"),_=i("F2Ol");function P(e,t){if(1&e){var i=d.Xb();d.Wb(0,"th",9),d.Wb(1,"a",10),d.ic("click",(function(){return d.Bc(i),d.kc(3).showHideExtendedFields()})),d.Rb(2,"fa-icon",11),d.Vb(),d.Vb()}if(2&e){var s=d.kc(3);d.Cb(2),d.pc("icon",s.hideExtendedFields?"angle-double-right":"angle-double-down")}}function z(e,t){if(1&e&&(d.Wb(0,"span",12),d.Kc(1),d.Vb()),2&e){var i=d.kc(3);d.Cb(1),d.Mc(" ",i.filteredItems.length," ")}}function D(e,t){if(1&e&&(d.Wb(0,"option",16),d.Kc(1),d.Vb()),2&e){var i=t.$implicit;d.pc("value",i.key),d.Cb(1),d.Mc(" ",i.key+" ("+i.count+")","")}}function Q(e,t){if(1&e){var i=d.Xb();d.Wb(0,"select",13),d.ic("ngModelChange",(function(e){return d.Bc(i),d.kc(3).issueTypeFilter=e}))("change",(function(){return d.Bc(i),d.kc(3).onFilterChanged()})),d.Wb(1,"option",14),d.Kc(2,"All"),d.Vb(),d.Ic(3,D,2,2,"option",15),d.Vb()}if(2&e){var s=d.kc(3);d.pc("ngModel",s.issueTypeFilter),d.Cb(3),d.pc("ngForOf",s.issueTypeStats)}}function B(e,t){if(1&e&&(d.Wb(0,"option",16),d.Kc(1),d.Vb()),2&e){var i=t.$implicit;d.pc("value",i.key),d.Cb(1),d.Mc(" ",i.key+" ("+i.count+")","")}}function X(e,t){if(1&e){var i=d.Xb();d.Wb(0,"select",13),d.ic("ngModelChange",(function(e){return d.Bc(i),d.kc(3).statusFilter=e}))("change",(function(){return d.Bc(i),d.kc(3).onFilterChanged()})),d.Wb(1,"option",14),d.Kc(2,"All"),d.Vb(),d.Ic(3,B,2,2,"option",15),d.Vb()}if(2&e){var s=d.kc(3);d.pc("ngModel",s.statusFilter),d.Cb(3),d.pc("ngForOf",s.statusStats)}}function N(e,t){if(1&e){var i=d.Xb();d.Wb(0,"td"),d.Wb(1,"a",10),d.ic("click",(function(){d.Bc(i);var e=d.kc().$implicit;return e.hideExtendedFields=!e.hideExtendedFields})),d.Rb(2,"fa-icon",11),d.Vb(),d.Vb()}if(2&e){var s=d.kc().$implicit;d.Cb(2),d.pc("icon",s.hideExtendedFields?"angle-right":"angle-down")}}function H(e,t){if(1&e&&(d.Wb(0,"tr"),d.Wb(1,"td",24),d.Kc(2),d.Vb(),d.Wb(3,"td",25),d.Kc(4),d.Vb(),d.Vb()),2&e){var i=t.$implicit;d.Cb(2),d.Mc("",i.name,":"),d.Cb(2),d.Mc(" ",i.value," ")}}function J(e,t){if(1&e&&(d.Wb(0,"div",22),d.Wb(1,"table",23),d.Ic(2,H,5,2,"tr",8),d.Vb(),d.Vb()),2&e){var i=d.kc().$implicit;d.Cb(2),d.pc("ngForOf",i.extendedFields)}}function G(e,t){if(1&e&&(d.Wb(0,"tr"),d.Ic(1,N,3,1,"td",0),d.Wb(2,"td",17),d.Kc(3),d.Vb(),d.Wb(4,"td"),d.Wb(5,"div"),d.Kc(6),d.Vb(),d.Ic(7,J,3,1,"div",18),d.Vb(),d.Wb(8,"td",19),d.Wb(9,"small",20),d.Kc(10),d.Vb(),d.Vb(),d.Wb(11,"td",19),d.Wb(12,"span",21),d.Kc(13),d.Vb(),d.Vb(),d.Vb()),2&e){var i=t.$implicit,s=d.kc(3);d.Cb(1),d.pc("ngIf",s.hasExtendedFields),d.Cb(2),d.Mc(" ",i.key," "),d.Cb(3),d.Lc(i.title),d.Cb(1),d.pc("ngIf",!i.hideExtendedFields&&i.extendedFields&&i.extendedFields.length>0),d.Cb(3),d.Lc(i.issueType),d.Cb(3),d.Lc(i.status)}}function q(e,t){if(1&e&&(d.Wb(0,"div"),d.Wb(1,"table",2),d.Wb(2,"thead"),d.Wb(3,"tr"),d.Ic(4,P,3,1,"th",3),d.Wb(5,"th",4),d.Ic(6,z,2,1,"span",5),d.Kc(7),d.Vb(),d.Wb(8,"th",6),d.Ic(9,Q,4,2,"select",7),d.Vb(),d.Wb(10,"th",6),d.Ic(11,X,4,2,"select",7),d.Vb(),d.Vb(),d.Vb(),d.Ic(12,G,14,6,"tr",8),d.Vb(),d.Vb()),2&e){var i=d.kc(2);d.Cb(4),d.pc("ngIf",i.hasExtendedFields),d.Cb(2),d.pc("ngIf",i.filteredItems.length>0),d.Cb(1),d.Mc(" record",i.filteredItems.length>1?"s":""," "),d.Cb(2),d.pc("ngIf",i.issueTypeStats&&i.issueTypeStats.length>1),d.Cb(2),d.pc("ngIf",i.statusStats&&i.statusStats.length>1),d.Cb(1),d.pc("ngForOf",i.filteredItems)}}function U(e,t){1&e&&(d.Wb(0,"div",26),d.Kc(1," No detail records found. "),d.Vb())}function Z(e,t){if(1&e&&(d.Wb(0,"div"),d.Ic(1,q,13,6,"div",0),d.Ic(2,U,2,0,"div",1),d.Vb()),2&e){var i=d.kc();d.Cb(1),d.pc("ngIf",i.filteredItems&&i.filteredItems.length>0),d.Cb(1),d.pc("ngIf",i.filteredItems&&0===i.filteredItems.length)}}var Y,ee=((Y=function(){function e(t,i,s){_classCallCheck(this,e),this.jiraService=t,this.persistenceService=i,this.store$=s,this.childIssueType="",this.hasExtendedFields=!1,this.showDetails=!1,this.hideExtendedFields=!0,this.statusFilter="all",this.issueTypeFilter="all"}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this,t=this.store$.select((function(e){return e.purpose.selectedItem})).pipe(Object(b.a)((function(e){return e}))),i=this.store$.select((function(e){return e.app.projects}));this.issueSubscription=Object(R.a)(t,i).subscribe((function(t){var i=_slicedToArray(t,2),s=i[0],n=i[1];e.issue=s,e.issue.project=M.find(n,{key:e.issue.project.key}),e.loadDetails(e.issue)}))}},{key:"ngOnDestroy",value:function(){this.issueSubscription&&this.issueSubscription.unsubscribe(),this.projectsSubscription&&this.projectsSubscription.unsubscribe()}},{key:"loadDetails",value:function(e){var t=this;if(e.project&&e.project.subTaskIssueTypes&&e.project.subTaskIssueTypes.length>0){var i=M.join(M.map(e.project.subTaskIssueTypes,(function(e){return"'".concat(e.name,"'")})),","),s=M.spread(M.union)(M.map(e.project.subTaskIssueTypes,"list"));this.hasExtendedFields=s&&s.length>0;var n=M.map(s,"id");this.jiraService.executeJql("issuetype in (".concat(i,") AND parent=").concat(e.key),0,100,n,"test-cases.json").pipe(Object(b.a)((function(e){return e&&e.issues}))).subscribe((function(e){t.childItems=Object(E.f)(e.issues),t.childItems.forEach((function(e){return e.hideExtendedFields=!0})),Object(E.b)(t.childItems,s),t.onFilterChanged();var i=M.mapValues(M.groupBy(M.map(t.childItems,"status")),(function(e){return e.length}));t.statusStats=Object.keys(i).map((function(e){return{key:e,count:i[e]}}));var n=M.mapValues(M.groupBy(M.map(t.childItems,"issueType")),(function(e){return e.length}));t.issueTypeStats=Object.keys(n).map((function(e){return{key:e,count:n[e]}}))}))}}},{key:"onFilterChanged",value:function(){var e=this;this.filteredItems=M.filter(this.childItems,(function(t){return!(e.statusFilter&&"all"!==e.statusFilter&&t.status!==e.statusFilter||e.issueTypeFilter&&"all"!==e.issueTypeFilter&&t.issueType!==e.issueTypeFilter)})),this.filteredItems=M.orderBy(this.filteredItems,["issueType","status"])}},{key:"showHideExtendedFields",value:function(){var e=this;this.hideExtendedFields=!this.hideExtendedFields,this.childItems&&this.childItems.forEach((function(t){return t.hideExtendedFields=e.hideExtendedFields}))}}]),e}()).\u0275fac=function(e){return new(e||Y)(d.Qb(_.b),d.Qb(p.a),d.Qb(n.h))},Y.\u0275cmp=d.Kb({type:Y,selectors:[["app-task-list"]],decls:1,vars:1,consts:[[4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"table"],["width","1%",4,"ngIf"],["colspan","2",1,"text-muted"],["class","mr-1",4,"ngIf"],["width","10%"],["class","form-control form-control-sm bg-light border-0",3,"ngModel","ngModelChange","change",4,"ngIf"],[4,"ngFor","ngForOf"],["width","1%"],["title","Show/hide details",1,"text-muted",3,"click"],["size","sm",3,"icon"],[1,"mr-1"],[1,"form-control","form-control-sm","bg-light","border-0",3,"ngModel","ngModelChange","change"],["value","all"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["width","5%",1,"text-muted","font-weight-light",2,"white-space","nowrap"],["style","overflow: auto;","class","alert mt-2 p-0 rounded-0 border-0",4,"ngIf"],[2,"white-space","nowrap"],[1,"text-muted"],[1,"pl-1","pr-1","border","rounded","bg-light","small"],[1,"alert","mt-2","p-0","rounded-0","border-0",2,"overflow","auto"],[1,"table","table-small","small","p-0","m-0","border-0","bg-light","extended-fields"],["width","10%",1,"p-1","text-nowrap","text-muted"],["Markdown","",1,"p-1","text-dark"],[1,"alert","alert-warning"]],template:function(e,t){1&e&&d.Ic(0,Z,3,2,"div",0),2&e&&d.pc("ngIf",t.issue)},directives:[s.l,s.k,f.a,L.i,L.f,L.g,L.h,L.j,h.a],encapsulation:2}),Y),te=i("lJxs"),ie=i("LvOF");function se(e,t){if(1&e&&(d.Wb(0,"span",19),d.Kc(1),d.Vb()),2&e){var i=t.$implicit;d.Cb(1),d.Lc(i)}}function ne(e,t){if(1&e&&(d.Wb(0,"div",16),d.Wb(1,"span",17),d.Kc(2,"FIX VERSION: "),d.Vb(),d.Ic(3,se,2,1,"span",18),d.Vb()),2&e){var i=d.kc(2);d.Cb(3),d.pc("ngForOf",i.selectedItem.fixVersions)}}function ce(e,t){if(1&e&&(d.Wb(0,"span",22),d.Kc(1),d.Vb()),2&e){var i=t.$implicit;d.Cb(1),d.Lc(i)}}function re(e,t){if(1&e&&(d.Wb(0,"div",20),d.Ic(1,ce,2,1,"span",21),d.Vb()),2&e){var i=d.kc(2);d.Cb(1),d.pc("ngForOf",i.selectedItem.labels)}}function le(e,t){1&e&&(d.Wb(0,"a",23),d.Rb(1,"fa-icon",24),d.Kc(2," Task breakup "),d.Vb()),2&e&&d.pc("routerLinkActive","active")}var oe=function(e){return["../../storyboard",e,"details"]},ae=function(e){return["../../storyboard",e,"list"]},ue=function(){return["far","copy"]};function de(e,t){if(1&e&&(d.Wb(0,"div",25),d.Wb(1,"a",26),d.Rb(2,"fa-icon",27),d.Kc(3," Storyboard "),d.Vb(),d.Wb(4,"div",28),d.Rb(5,"button",29),d.Wb(6,"div",30),d.Wb(7,"a",31),d.Rb(8,"fa-icon",13),d.Kc(9," Story list "),d.Vb(),d.Vb(),d.Vb(),d.Vb()),2&e){var i=d.kc(2);d.Cb(1),d.pc("routerLink",d.tc(5,oe,i.selectedItem.key))("routerLinkActive","active"),d.Cb(6),d.pc("routerLink",d.tc(7,ae,i.selectedItem.key))("routerLinkActive","active"),d.Cb(1),d.pc("icon",d.sc(9,ue))}}var be=function(){return["details"]},pe=function(){return["far","lightbulb"]};function fe(e,t){if(1&e&&(d.Wb(0,"div",2),d.Wb(1,"div",3),d.Wb(2,"div"),d.Ic(3,ne,4,1,"div",4),d.Wb(4,"sub",5),d.Kc(5),d.Vb(),d.Wb(6,"sub",6),d.Kc(7),d.Vb(),d.Vb(),d.Wb(8,"h2",7),d.Kc(9),d.Vb(),d.Ic(10,re,2,1,"div",8),d.Wb(11,"div",9),d.Wb(12,"div",10),d.Wb(13,"div",11),d.Wb(14,"a",12),d.Rb(15,"fa-icon",13),d.Kc(16," Purpose "),d.Vb(),d.Ic(17,le,3,1,"a",14),d.Ic(18,de,10,10,"div",15),d.Vb(),d.Vb(),d.Vb(),d.Vb(),d.Vb()),2&e){var i=d.kc();d.Cb(3),d.pc("ngIf",i.selectedItem.fixVersions&&i.selectedItem.fixVersions.length>0),d.Cb(2),d.Nc("",i.selectedItem.issueType,": ",i.selectedItem.key,""),d.Cb(2),d.Mc(" ",i.selectedItem.status," "),d.Cb(2),d.Mc(" ",i.selectedItem.title," "),d.Cb(1),d.pc("ngIf",i.selectedItem.labels&&i.selectedItem.labels.length>0),d.Cb(4),d.pc("routerLink",d.sc(11,be))("routerLinkActive","active"),d.Cb(1),d.pc("icon",d.sc(12,pe)),d.Cb(2),d.pc("ngIf","Epic"!==i.selectedItem.issueType),d.Cb(1),d.pc("ngIf",i.canNavigateToStoryboard())}}var he,me=((he=function(){function e(t,i,s,n){_classCallCheck(this,e),this.activatedRoute=t,this.persistenceService=i,this.jiraService=s,this.store$=n,this.currentIssueKey=""}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.localNodeType=E.a,this.currentIssueKey$=this.store$.select((function(e){return e.app.currentIssueKey})).pipe(Object(b.a)((function(e){return e&&e.length>0}))).subscribe((function(t){return e.currentIssueKey=t})),this.selectedItem$=this.store$.select((function(e){return e.purpose.selectedItem})).pipe(Object(b.a)((function(e){return e}))).subscribe((function(t){return e.selectedItem=t})),this.issueQuery$=this.store$.select((function(e){return e.app.hierarchicalIssue})).pipe(Object(b.a)((function(e){return e}))),this.paramsQuery$=this.activatedRoute.params.pipe(Object(b.a)((function(e){return e&&e.selected&&e.selected.length>0})),Object(te.a)((function(e){return e.selected}))),this.projectsQuery$=this.store$.select((function(e){return e.app.projects})).pipe(Object(b.a)((function(e){return e}))),this.combined$=Object(R.a)(this.issueQuery$,this.paramsQuery$,this.projectsQuery$).subscribe((function(t){var i=_slicedToArray(t,3),s=i[0],n=i[1],c=i[2];e.projects=c;var r=Object(E.m)(s,E.a.Project),l=Object(E.n)(s,n);if(r&&l){l.extendedFields=Object(ie.a)(e.projects,r.key,l.issueType);var a=M.map(l.extendedFields,"id");e.jiraService.getIssueDetails(n,a).pipe(Object(b.a)((function(e){return null!=e&&e.fields}))).subscribe((function(t){Object(E.d)(Object(E.k)(t),l),l.extendedFields=M.map(l.extendedFields,(function(e){return e.value=t.fields[e.id],e}));var i=M.pick(l,["key","label","title","issueType","project","status","description","components","labels","fixVersions","extendedFields","children"]);e.store$.dispatch(new o(i))}))}setTimeout((function(){return e.markIssueSelected(l)}),500)}))}},{key:"ngOnDestroy",value:function(){this.combined$&&this.combined$.unsubscribe(),this.selectedItem$&&this.selectedItem$.unsubscribe(),this.currentIssueKey$&&this.currentIssueKey$.unsubscribe()}},{key:"markIssueSelected",value:function(e){var t=this;if(e)if(this.projects&&e.project&&(e.extendedFields=Object(ie.a)(this.projects,e.project.key,e.issueType)),!e.parent||e.parent.issueType!==E.a.RelatedLink||e.description&&0!==e.description.length)this.expandPurpose(e);else{var i=M.map(e.extendedFields,"id");this.jiraService.getIssueDetails(e.key,i).pipe(Object(b.a)((function(e){return null!=e}))).subscribe((function(i){var s=Object(E.k)(i);s&&Object(E.d)(s,e),e.extendedFields=M.map(e.extendedFields,(function(e){return e.value=i.fields[e.id],e})),t.expandPurpose(e)}))}}},{key:"expandPurpose",value:function(e){this.purpose=[],this.populatePurpose(e),M.reverse(this.purpose),this.store$.dispatch(new a(this.purpose))}},{key:"populatePurpose",value:function(e){e&&(e.issueType!==E.a.EpicChildren&&e.issueType!==E.a.RelatedLink&&this.purpose.push({key:e.key,issueType:e.issueType,title:e.title,purpose:e.description,editable:e.editable,hfKey:e.hfKey}),e.parent&&this.populatePurpose(e.parent))}},{key:"canNavigateToStoryboard",value:function(){return this.selectedItem&&("Epic"===this.selectedItem.issueType||this.currentIssueKey.toLowerCase()===this.selectedItem.key.toLowerCase())}}]),e}()).\u0275fac=function(e){return new(e||he)(d.Qb($.a),d.Qb(p.a),d.Qb(_.b),d.Qb(n.h))},he.\u0275cmp=d.Kb({type:he,selectors:[["app-container"]],decls:4,vars:1,consts:[[1,"pt-0","pr-3","pb-2","pl-3"],["class","sticky-title pb-3",4,"ngIf"],[1,"sticky-title","pb-3"],[1,"border-bottom"],["class","float-right small",4,"ngIf"],[1,"text-uppercase","mr-2"],[1,"badge","badge-light","small","text-muted","text-uppercase","font-weight-normal"],[1,"font-weight-light","mb-0"],["class","small",4,"ngIf"],[1,"pb-2"],[1,"row"],[1,"col-md-8"],["title","View purpose",1,"btn","btn-link","mr-1","pl-0",3,"routerLink","routerLinkActive"],["size","sm",3,"icon"],["class","btn btn-link mr-1","routerLink","items",3,"routerLinkActive",4,"ngIf"],["class","btn-group mr-1",4,"ngIf"],[1,"float-right","small"],[1,"small","text-muted"],["class","badge badge-light ml-1",4,"ngFor","ngForOf"],[1,"badge","badge-light","ml-1"],[1,"small"],["class","mr-1 pl-1 pr-1 bg-light text-muted rounded",4,"ngFor","ngForOf"],[1,"mr-1","pl-1","pr-1","bg-light","text-muted","rounded"],["routerLink","items",1,"btn","btn-link","mr-1",3,"routerLinkActive"],["icon","list-ol","size","sm"],[1,"btn-group","mr-1"],[1,"btn","btn-link","pr-0",3,"routerLink","routerLinkActive"],["icon","map","size","sm"],["ngbDropdown","","display","dynamic","placement","bottom-right"],["id","dropdownBasic1","ngbDropdownToggle","","title","story list",1,"btn","btn-link"],["ngbDropdownMenu","","aria-labelledby","dropdownBasic1",1,"dropdown-menu-right"],["ngbDropdownItem","",3,"routerLink","routerLinkActive"]],template:function(e,t){1&e&&(d.Wb(0,"div",0),d.Ic(1,fe,19,13,"div",1),d.Wb(2,"div"),d.Rb(3,"router-outlet"),d.Vb(),d.Vb()),2&e&&(d.Cb(1),d.pc("ngIf",t.selectedItem))},directives:[s.l,$.h,$.f,$.e,f.a,s.k,m.d,m.h,m.f,m.e],encapsulation:2}),he);i.d(t,"PurposeModule",(function(){return ye}));var ge,ve=[{path:":selected",component:me,children:[{path:"items",component:ee},{path:"attributes",component:V},{path:"details",component:T},{path:"",redirectTo:"details",pathMatch:"full"}]}],ye=((ge=function e(){_classCallCheck(this,e)}).\u0275mod=d.Ob({type:ge}),ge.\u0275inj=d.Nb({factory:function(e){return new(e||ge)},imports:[[s.c,$.g,L.c,h.b,f.c,A.b,m.g,m.c,K.a,n.i.forFeature("purpose",u,{initialState:c}),$.g.forChild(ve)]]}),ge)}}]);